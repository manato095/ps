
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>数値暗号化・買取価格ツール</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        textarea, input, button { font-size: 1em; margin: 5px 0; width: 100%; }
        .result { margin-top: 10px; font-weight: bold; white-space: pre-line; }
    </style>
</head>
<body>
    <h1>6桁数値 暗号化・買取価格ツール</h1>

    <label>数値を入力（1行に1つ）：</label><br>
    <textarea id="inputNumbers" rows="6" placeholder="例：348291\n123456"></textarea><br>

    <button onclick="processEncrypt()">暗号化</button>
    <button onclick="processDecrypt()">買取価格</button>
    <br><br>

    <label>画像から読み取る（OCR機能）:</label>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="processImage()">画像読み取り＋処理</button>

    <div class="result" id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script>
        const encodeTable = {
            1: [5,6,7,8,9,1,2,3,4],
            10: [5,6,7,8,9,1,2,3,4],
            100: [3,4,5,6,7,8,9,1,2],
            1000: [3,4,5,6,7,8,9,1,2],
            10000: [2,3,4,5,6,7,8,9,1],
            100000: [4,5,6,7,8,9,1,2,3],
        };

        const decodeTable = {};
        for (let place in encodeTable) {
            decodeTable[place] = {};
            encodeTable[place].forEach((val, i) => {
                decodeTable[place][val] = i + 1;
            });
        }

        function encrypt(number) {
            let num = number.toString().padStart(6, "0");
            let result = "";
            for (let i = 0; i < 6; i++) {
                const digit = parseInt(num[i]);
                const place = Math.pow(10, 5 - i);
                result += digit === 0 ? "0" : encodeTable[place][digit - 1];
            }
            return result;
        }

        function decrypt(number) {
            let num = number.toString().padStart(6, "0");
            let result = "";
            for (let i = 0; i < 6; i++) {
                const digit = parseInt(num[i]);
                const place = Math.pow(10, 5 - i);
                result += digit === 0 ? "0" : decodeTable[place][digit];
            }
            return parseInt(result, 10) + "円";
        }

        function processEncrypt() {
            const input = document.getElementById("inputNumbers").value.split(/\s+/);
            const output = input.map(line => line.trim()).filter(Boolean).map(n => encrypt(n));
            document.getElementById("result").innerText = "暗号化結果：\n" + output.join("\n");
        }

        function processDecrypt() {
            const input = document.getElementById("inputNumbers").value.split(/\s+/);
            const output = input.map(line => line.trim()).filter(Boolean).map(n => decrypt(n));
            document.getElementById("result").innerText = "買取価格：\n" + output.join("\n");
        }

        function processImage() {
            const file = document.getElementById("imageInput").files[0];
            if (!file) {
                alert("画像ファイルを選択してください。");
                return;
            }
            Tesseract.recognize(file, 'eng', { logger: m => console.log(m) })
                .then(({ data: { text } }) => {
                    document.getElementById("inputNumbers").value = text.replace(/[^0-9\n]/g, '');
                    alert("画像からテキストを読み取りました。必要に応じて編集してください。");
                });
        }
    </script>
</body>
</html>
